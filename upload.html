<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Image - InsulaAI</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="css/shared-styles.css" rel="stylesheet">
    <link href="css/modal.css" rel="stylesheet">
    
    <style>
        body {
            padding-top: 80px;
            background: var(--deep-black);
        }
        
        .bg-animated {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a0a2e 30%, #0f0a1a 60%, #0a0a0f 100%);
            background-size: 400% 400%;
            animation: gradientShift 20s ease infinite;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .circuit-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.05;
            background-image: 
                linear-gradient(var(--neon-cyan) 1px, transparent 1px),
                linear-gradient(90deg, var(--neon-cyan) 1px, transparent 1px);
            background-size: 60px 60px;
        }
        
        .navbar-glass {
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(25px);
            border-bottom: 1px solid rgba(0, 240, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 240, 255, 0.15);
        }
        
        .navbar-brand {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 1.5rem;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-violet));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 20px rgba(0, 240, 255, 0.6));
        }
        
        .content-wrapper {
            position: relative;
            z-index: 2;
            padding: 50px 0;
        }
        
        .page-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-violet));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 40px;
            filter: drop-shadow(0 0 30px rgba(0, 240, 255, 0.5));
        }
        
        .upload-card {
            background: rgba(26, 26, 36, 0.8);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(0, 240, 255, 0.3);
            border-radius: 25px;
            padding: 50px;
            box-shadow: 0 0 50px rgba(0, 240, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .upload-card.dragover {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 80px rgba(0, 240, 255, 0.5);
            background: rgba(26, 26, 36, 0.95);
        }
        
        .drop-zone {
            border: 3px dashed rgba(0, 240, 255, 0.3);
            border-radius: 20px;
            padding: 80px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(10, 10, 15, 0.4);
        }
        
        .drop-zone:hover {
            border-color: var(--neon-cyan);
            background: rgba(10, 10, 15, 0.6);
        }
        
        .drop-zone.active {
            border-color: var(--neon-cyan);
            box-shadow: inset 0 0 40px rgba(0, 240, 255, 0.2);
            background: rgba(0, 240, 255, 0.05);
        }
        
        .drop-icon {
            font-size: 80px;
            color: var(--neon-cyan);
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px var(--neon-cyan));
        }
        
        .drop-zone.hidden {
            display: none;
        }
        
        .preview-container {
            display: none;
            border: 3px solid var(--neon-cyan);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            background: rgba(10, 10, 15, 0.6);
            box-shadow: inset 0 0 40px rgba(0, 240, 255, 0.1);
        }
        
        .preview-container.active {
            display: block;
            animation: fadeInScale 0.5s ease;
        }
        
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .preview-image {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
            border-radius: 15px;
            border: 2px solid rgba(0, 240, 255, 0.3);
            box-shadow: 0 0 30px rgba(0, 240, 255, 0.4);
            margin-bottom: 15px;
        }
        
        .preview-info {
            color: var(--neon-cyan);
            font-family: 'Orbitron', sans-serif;
            margin-bottom: 15px;
        }
        
        .options-card {
            background: rgba(26, 26, 36, 0.8);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(0, 240, 255, 0.3);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 0 50px rgba(0, 240, 255, 0.2);
        }
        
        .option-title {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-cyan);
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        
        .form-check-label {
            color: #ccc;
            font-size: 1rem;
        }
        
        .form-check-input:checked {
            background-color: var(--neon-cyan);
            border-color: var(--neon-cyan);
        }
        
        .slider-container {
            margin: 20px 0;
        }
        
        .slider-label {
            color: var(--neon-cyan);
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .slider-value {
            color: #fff;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            background: rgba(0, 240, 255, 0.2);
            outline: none;
            border-radius: 5px;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--neon-cyan);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 15px var(--neon-cyan);
        }
        
        .analyze-btn {
            width: 100%;
            padding: 18px;
            font-size: 1.2rem;
            font-weight: 700;
            border: 2px solid var(--neon-cyan);
            background: transparent;
            color: #fff;
            border-radius: 50px;
            position: relative;
            overflow: hidden;
            transition: 0.4s;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 30px;
        }
        
        .analyze-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: var(--neon-cyan);
            transform: translate(-50%, -50%);
            transition: 0.6s;
            z-index: -1;
        }
        
        .analyze-btn:hover::before {
            width: 400%;
            height: 400%;
        }
        
        .analyze-btn:hover {
            color: var(--deep-black);
            box-shadow: 0 0 40px var(--neon-cyan);
        }
        
        .analyze-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .help-float {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--neon-cyan);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--deep-black);
            cursor: pointer;
            box-shadow: 0 0 30px var(--neon-cyan);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .help-float:hover {
            transform: scale(1.1);
            box-shadow: 0 0 50px var(--neon-cyan);
        }
        
        .weather-select {
            background: rgba(10, 10, 15, 0.8);
            border: 2px solid rgba(0, 240, 255, 0.3);
            color: #fff;
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%2300f0ff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px 12px;
            padding-right: 45px;
            cursor: pointer;
        }
        
        .weather-select option {
            background: #1a1a24;
            color: #fff;
            padding: 10px;
        }
        
        .weather-select:focus {
            background: rgba(10, 10, 15, 0.95);
            border-color: var(--neon-cyan);
            box-shadow: 0 0 25px rgba(0, 240, 255, 0.4);
            outline: none;
        }
    </style>
</head>
<body>
    <div class="bg-animated">
        <div class="circuit-grid"></div>
    </div>
    
    <nav class="navbar navbar-glass fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">‚ö° InsulaAI</a>
            <div>
                <a href="dashboard.html" class="auth-btn me-2">
                    <i class="bi bi-grid-3x3-gap"></i> Dashboard
                </a>
                <a href="index.html" class="auth-btn auth-btn-secondary">
                    <i class="bi bi-house"></i> Home
                </a>
            </div>
        </div>
    </nav>
    
    <div class="content-wrapper">
        <div class="container">
            <h1 class="page-title">Upload Insulator Image</h1>
            
            <div class="row">
                <div class="col-lg-7 mb-4">
                    <div class="upload-card">
                        <div class="drop-zone" id="dropZone">
                            <i class="bi bi-cloud-upload drop-icon"></i>
                            <h3 style="color: var(--neon-cyan); font-family: 'Orbitron';">Drag & Drop Image Here</h3>
                            <p style="color: #aaa; margin: 20px 0;">or</p>
                            <button class="auth-btn" onclick="document.getElementById('fileInput').click()">
                                <i class="bi bi-folder2-open"></i> Browse Files
                            </button>
                            <input type="file" id="fileInput" accept="image/*" style="display: none;">
                            <p style="color: #666; margin-top: 20px; font-size: 0.9rem;">
                                Supported formats: JPG, PNG, JPEG (Max 10MB)
                            </p>
                        </div>
                        
                        <div class="preview-container" id="previewContainer">
                            <div class="preview-info">
                                <i class="bi bi-check-circle-fill"></i> Image Uploaded Successfully
                            </div>
                            <img id="previewImage" class="preview-image" alt="Preview">
                            <div class="d-flex gap-2 justify-content-center">
                                <button class="auth-btn" onclick="removeImage()">
                                    <i class="bi bi-arrow-counterclockwise"></i> Change Image
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-5 mb-4">
                    <div class="options-card">
                        <h3 class="option-title"><i class="bi bi-gear-fill"></i> Detection Options</h3>
                        
                        <div class="mb-4">
                            <label class="slider-label">Detect Fault Types:</label>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" value="broken" id="detectBroken" checked>
                                <label class="form-check-label" for="detectBroken">Broken Insulators</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" value="dirty" id="detectDirty" checked>
                                <label class="form-check-label" for="detectDirty">Dirty/Contaminated</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="missing" id="detectMissing" checked>
                                <label class="form-check-label" for="detectMissing">Missing Insulators</label>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <div class="d-flex justify-content-between">
                                <label class="slider-label">Confidence Threshold</label>
                                <span class="slider-value" id="confidenceValue">75%</span>
                            </div>
                            <input type="range" min="0" max="100" value="75" id="confidenceSlider">
                            <small style="color: #888;">Higher = More accurate, fewer detections</small>
                        </div>
                        
                        <div class="slider-container">
                            <label class="slider-label">Weather Condition Simulation</label>
                            <select class="form-select weather-select" id="weatherSelect">
                                <option value="clear">‚òÄÔ∏è Clear</option>
                                <option value="fog">üå´Ô∏è Foggy</option>
                                <option value="rain">üåßÔ∏è Rainy</option>
                                <option value="glare">‚òÄÔ∏è Sun Glare</option>
                            </select>
                        </div>
                        
                        <button class="analyze-btn" id="analyzeBtn" disabled>
                            <i class="bi bi-lightning-charge-fill"></i> Analyze Image
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="help-float" onclick="showHelp()">
        <i class="bi bi-question-lg"></i>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/modal-vfx.js"></script>
    <script src="js/modal.js"></script>
    <script>
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const previewContainer = document.getElementById('previewContainer');
        const previewImage = document.getElementById('previewImage');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const confidenceSlider = document.getElementById('confidenceSlider');
        const confidenceValue = document.getElementById('confidenceValue');
        
        let uploadedFile = null;
        
        // Drag and drop handlers
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('active');
            document.querySelector('.upload-card').classList.add('dragover');
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('active');
            document.querySelector('.upload-card').classList.remove('dragover');
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('active');
            document.querySelector('.upload-card').classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });
        
        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                window.insulaModal.show({
                    title: 'Invalid File Type',
                    message: 'Please upload an image file (JPG, PNG, or JPEG)',
                    type: 'error'
                });
                return;
            }
            
            if (file.size > 10 * 1024 * 1024) {
                window.insulaModal.show({
                    title: 'File Too Large',
                    message: 'File size must be less than 10MB. Please select a smaller image.',
                    type: 'error'
                });
                return;
            }
            
            uploadedFile = file;
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                dropZone.classList.add('hidden');
                previewContainer.classList.add('active');
                analyzeBtn.disabled = false;
            };
            reader.readAsDataURL(file);
        }
        
        function removeImage() {
            uploadedFile = null;
            dropZone.classList.remove('hidden');
            previewContainer.classList.remove('active');
            analyzeBtn.disabled = true;
            fileInput.value = '';
        }
        
        confidenceSlider.addEventListener('input', (e) => {
            confidenceValue.textContent = e.target.value + '%';
        });
        
        analyzeBtn.addEventListener('click', () => {
            if (!uploadedFile) return;
            
            const options = {
                file: uploadedFile.name,
                broken: document.getElementById('detectBroken').checked,
                dirty: document.getElementById('detectDirty').checked,
                missing: document.getElementById('detectMissing').checked,
                confidence: confidenceSlider.value
            };
            
            console.log('Analyzing with options:', options);
            localStorage.setItem('uploadedImage', previewImage.src);
            localStorage.setItem('analysisOptions', JSON.stringify(options));
            window.location.href = 'processing.html';
        });
        
        function showHelp() {
            window.insulaModal.showHelp(
                'Upload Instructions',
                `<div style="text-align: left; line-height: 2;">
                    <p><strong>Step 1:</strong> Drag and drop your insulator image or click <strong>Browse Files</strong></p>
                    <p><strong>Step 2:</strong> Adjust detection options as needed</p>
                    <p><strong>Step 3:</strong> Set confidence threshold (75% recommended)</p>
                    <p><strong>Step 4:</strong> Click <strong>Analyze Image</strong> to start processing</p>
                    <hr style="border-color: rgba(0, 240, 255, 0.2); margin: 20px 0;">
                    <p style="color: #888;"><i class="bi bi-lightbulb"></i> <strong>Tip:</strong> For best results, use clear images with good lighting.</p>
                </div>`
            );
        }
    </script>
</body>
</html>
